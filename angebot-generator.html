<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kristallkraft Angebotsgenerator</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .produkt { margin-bottom: 12px; }
    .produkt label { display: inline-block; width: 200px; }
    .inputgroup { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; align-items: center; }
    input[type=number], input[type=text] { width: 60px; }
    input[type=text].wide { width: 200px; }
    select { width: 90px; }
    textarea {
      width: 100%;
      height: 200px;
      margin-top: 20px;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      font-size: 16px;
    }
    #angebotHTML {
      border: 1px solid #ccc;
      padding: 15px;
      margin-top: 20px;
      background: #f9f9f9;
    }
  </style>
</head>
<body>

  <h2>üõçÔ∏è Produkte & F√ºtterung konfigurieren</h2>

  <div style="margin-bottom: 10px;">
    <label for="kundenname"><strong>Kundenname:</strong></label>
    <input type="text" id="kundenname" class="wide" placeholder="z.‚ÄØB. Max Mustermann">
  </div>

  <div style="margin-bottom: 10px;">
    <label for="beraterin"><strong>Beraterin:</strong></label>
    <select id="beraterin">
      <option value="">‚Äì Bitte w√§hlen ‚Äì</option>
      <option value="Sofie">Sofie</option>
      <option value="Merle">Merle</option>
      <option value="Steffi">Steffi</option>
      <option value="Katrin">Katrin</option>
      <option value="Nadin">Nadin</option>
      <option value="Bea">Bea</option>
      <option value="Tatjana">Tatjana</option>
    </select>
  </div>

  <div style="margin-bottom: 10px;">
    <label for="kontaktkanal"><strong>Kontaktkanal:</strong></label>
    <select id="kontaktkanal">
      <option value="">‚Äì Bitte w√§hlen ‚Äì</option>
      <option value="chat">Chat</option>
      <option value="telefon">Telefon</option>
    </select>
  </div>

  <div style="margin-bottom: 20px;">
    <label for="outputMode"><strong>Ausgabeformat:</strong></label>
    <select id="outputMode">
      <option value="text">Text (f√ºr Chat / WhatsApp)</option>
      <option value="html">HTML (f√ºr E-Mail)</option>
    </select>
  </div>

  <form id="angebotForm"></form>

  <button type="button" id="generateButton">üöÄ Angebotstext generieren</button>

  <h3>üìã Dein Angebotstext:</h3>
  <textarea id="angebotText" readonly>Noch kein Angebot erstellt.</textarea>
  <div id="angebotHTML" style="display:none;"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const SHOP_DOMAIN = "kristallkraft-pferdefutter.de";
      const produkte = [
        { id: "42640144892146", name: "Kristallkraft No1" },
        { id: "42640145514738", name: "Kristallkraft No2" },
        { id: "43527031652617", name: "Kristallkraft Coolly" },
        { id: "42640147874034", name: "Kristallkraft Move" },
        { id: "42640136569074", name: "Kristallkraft Bro" },
        { id: "42640142270706", name: "Kristallkraft Femmina" },
        { id: "42640136044786", name: "Kristallkraft Brave Horse" },
        { id: "42640139124978", name: "Kristallkraft Core" },
        { id: "44241608769801", name: "Kristallkraft Muscolo" },
        { id: "42640147185906", name: "Kristallkraft Mental Balance" },
        { id: "42712424906994", name: "Kristallkraft TheMineral" }
      ];

      const form = document.getElementById("angebotForm");
      produkte.forEach(prod => {
        const block = document.createElement("div");
        block.className = "produkt";
        block.innerHTML = `
          <label>${prod.name}</label>
          <div class="inputgroup">
            <input type="number" name="qty-${prod.id}" placeholder="Menge" min="0" value="0"> ‚û°Ô∏è
            <input type="text" name="start-${prod.id}" placeholder="z.‚ÄØB. 2"> ‚û°Ô∏è
            <select name="dauer-${prod.id}">
              <option value="">Dauer w√§hlen</option>
              <option value="eine Woche">eine Woche</option>
              <option value="zwei Wochen">zwei Wochen</option>
              <option value="drei Wochen">drei Wochen</option>
              <option value="vier Wochen">vier Wochen</option>
              <option value="f√ºnf Wochen">f√ºnf Wochen</option>
              <option value="sechs Wochen">sechs Wochen</option>
            </select> ‚û°Ô∏è
            <select name="ab-${prod.id}">
              <option value="">Langfristig ab...</option>
              <option value="ab der zweiten Woche">ab der zweiten Woche</option>
              <option value="ab der dritten Woche">ab der dritten Woche</option>
              <option value="ab der vierten Woche">ab der vierten Woche</option>
              <option value="ab der f√ºnften Woche">ab der f√ºnften Woche</option>
              <option value="ab der sechsten Woche">ab der sechsten Woche</option>
              <option value="ab der siebten Woche">ab der siebten Woche</option>
            </select> ‚û°Ô∏è
            <input type="text" name="nach-${prod.id}" placeholder="z.‚ÄØB. 1">
          </div>
        `;
        form.appendChild(block);
      });

      // Beraterin merken
      const beraterin = document.getElementById("beraterin");
      beraterin.value = localStorage.getItem("beraterin") || "";
      beraterin.addEventListener("change", () => {
        localStorage.setItem("beraterin", beraterin.value);
      });

      document.getElementById("generateButton").addEventListener("click", () => {
        const kunde = document.getElementById("kundenname").value.trim();
        const kanal = document.getElementById("kontaktkanal").value.trim();
        const berater = document.getElementById("beraterin").value.trim();
        const mode = document.getElementById("outputMode").value;
        const outputText = document.getElementById("angebotText");
        const outputHTML = document.getElementById("angebotHTML");

        const refParts = [];
        if (kanal) refParts.push(kanal);
        if (berater) refParts.push(berater);
        const refTag = refParts.length > 0 ? `?ref=${encodeURIComponent(refParts.join('-'))}` : "";

        let items = [];
        let textProdukte = [];

        produkte.forEach(prod => {
          const qty = parseInt(document.querySelector(`[name="qty-${prod.id}"]`).value);
          if (!qty || qty <= 0) return;

          const start = document.querySelector(`[name="start-${prod.id}"]`).value.trim();
          const dauer = document.querySelector(`[name="dauer-${prod.id}"]`).value.trim();
          const ab = document.querySelector(`[name="ab-${prod.id}"]`).value.trim();
          const nach = document.querySelector(`[name="nach-${prod.id}"]`).value.trim();

          let details = [];
          if (start && dauer) details.push(`${start} Messbecher f√ºr ${dauer}`);
          else if (start) details.push(`${start} Messbecher`);
          if (ab && nach) details.push(`${ab} ${nach} Messbecher`);

          const zusatz = details.length > 0 ? ` (${details.join(", ")})` : "";
          items.push(`${prod.id}:${qty}`);
          textProdukte.push(`${qty}x ${prod.name}${zusatz}`);
        });

        if (items.length === 0) {
          outputText.value = "‚ùó Bitte gib bei mindestens einem Produkt eine Menge gr√∂√üer 0 ein.";
          outputHTML.style.display = "none";
          outputText.style.display = "block";
          return;
        }

        const cartUrl = `https://${SHOP_DOMAIN}/cart/${items.join(',')}${refTag}`;
        const begruessung = kunde ? `Hallo ${kunde},\n\n` : "";

        const bodyText = `${begruessung}Wie gerade besprochen sende ich Ihnen unsere Produktempfehlung f√ºr Ihr Pferd:\n\n${textProdukte.join("\n")}\n\nüëâ Jetzt bestellen: ${cartUrl}`;

        if (mode === "text") {
          outputText.style.display = "block";
          outputHTML.style.display = "none";
          outputText.value = bodyText;
        } else {
          outputText.style.display = "none";
          outputHTML.style.display = "block";
          outputHTML.innerHTML = `
            <p>${kunde ? `Hallo ${kunde},` : ""}</p>
            <p>Wie gerade besprochen sende ich Ihnen unsere Produktempfehlung f√ºr Ihr Pferd:</p>
            <ul>${textProdukte.map(p => `<li>${p}</li>`).join("")}</ul>
            <p>
              üëâ <a href="${cartUrl}" target="_blank" style="display:inline-block;padding:10px 20px;background:#4CAF50;color:white;text-decoration:none;border-radius:5px;">üõí Jetzt bestellen</a>
            </p>
          `;
        }
      });
    });
  </script>
</body>
</html>