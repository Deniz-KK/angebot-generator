<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kristallkraft Angebotsgenerator</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .produkt { margin-bottom: 12px; }
    .produkt label { display: inline-block; width: 250px; }
    input[type=number], select { width: 150px; }
    button { margin-top: 20px; padding: 10px; font-size: 16px; }
    textarea { width: 100%; height: 200px; margin-top: 20px; }
    #angebotHTML { border: 1px solid #ccc; padding: 15px; margin-top: 20px; background: #f9f9f9; }
  </style>
</head>
<body>

  <h2>🛍️ Produkte & Mengen auswählen</h2>

  <!-- Kontaktkanal -->
  <div style="margin-bottom: 10px;">
    <label for="kontaktkanal"><strong>Kontaktkanal:</strong></label>
    <select id="kontaktkanal">
      <option value="">– Bitte wählen –</option>
      <option value="chat">Chat</option>
      <option value="telefon">Telefon</option>
    </select>
  </div>

  <!-- Ausgabeformat -->
  <div style="margin-bottom: 20px;">
    <label for="outputMode"><strong>Ausgabeformat:</strong></label>
    <select id="outputMode">
      <option value="text">Text</option>
      <option value="html">HTML</option>
    </select>
  </div>

  <!-- Produkte -->
  <form id="angebotForm">
    <div class="produkt"><label>Kristallkraft No1</label><input type="number" name="42640144892146" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft No2</label><input type="number" name="42640145514738" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Coolly</label><input type="number" name="43527031652617" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Move</label><input type="number" name="42640147874034" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Bro</label><input type="number" name="42640136569074" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Femmina</label><input type="number" name="42640142270706" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Brave Horse</label><input type="number" name="42640136044786" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Core</label><input type="number" name="42640139124978" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Muscolo</label><input type="number" name="44241608769801" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft Mental Balance</label><input type="number" name="42640147185906" min="0" value="0"></div>
    <div class="produkt"><label>Kristallkraft TheMineral</label><input type="number" name="42712424906994" min="0" value="0"></div>
  </form>

  <button type="button" id="generateButton">🚀 Angebotstext generieren</button>

  <!-- TEXT-Ausgabe -->
  <h3>📋 Dein Angebotstext:</h3>
  <textarea id="angebotText" readonly>Noch kein Angebot erstellt.</textarea>
  <br>
  <button type="button" id="copyButton">📋 Text kopieren</button>

  <!-- HTML-Ausgabe -->
  <div id="angebotHTML" style="display:none;"></div>

  <script>
    const SHOP_DOMAIN = "kristallkraft-pferdefutter.de";

    const produktNamen = {
      "42640144892146": "Kristallkraft No1",
      "42640145514738": "Kristallkraft No2",
      "43527031652617": "Kristallkraft Coolly",
      "42640147874034": "Kristallkraft Move",
      "42640136569074": "Kristallkraft Bro",
      "42640142270706": "Kristallkraft Femmina",
      "42640136044786": "Kristallkraft Brave Horse",
      "42640139124978": "Kristallkraft Core",
      "44241608769801": "Kristallkraft Muscolo",
      "42640147185906": "Kristallkraft Mental Balance",
      "42712424906994": "Kristallkraft TheMineral"
    };

    document.getElementById("generateButton").addEventListener("click", function () {
      const inputs = document.querySelectorAll('#angebotForm input[type=number]');
      let items = [];
      let textProdukte = [];

      inputs.forEach(input => {
        const qty = parseInt(input.value);
        if (qty > 0) {
          const variantId = input.name;
          items.push(`${variantId}:${qty}`);
          textProdukte.push(`- ${qty}x ${produktNamen[variantId]}`);
        }
      });

      const kanal = document.getElementById("kontaktkanal").value.trim();
      const refTag = kanal ? `?ref=${encodeURIComponent(kanal)}` : "";
      const outputText = document.getElementById("angebotText");
      const outputHTML = document.getElementById("angebotHTML");
      const mode = document.getElementById("outputMode").value;

      if (items.length === 0) {
        outputText.value = "❗ Bitte gib bei mindestens einem Produkt eine Menge größer 0 ein.";
        outputHTML.style.display = "none";
        return;
      }

      const cartUrl = `https://${SHOP_DOMAIN}/cart/${items.join(',')}${refTag}`;

      if (mode === "text") {
        outputText.style.display = "block";
        outputHTML.style.display = "none";

        outputText.value = `Wie gerade besprochen sende ich dir unsere Produktempfehlung für dein Pferd zu.\n\n${textProdukte.join("\n")}\n\n👉 Jetzt bestellen: ${cartUrl}\n\nLiebe Grüße\nDein Kristallkraft-Team`;
      } else {
        outputText.style.display = "none";
        outputHTML.style.display = "block";

        outputHTML.innerHTML = `
          <p>Wie gerade besprochen sende ich dir unsere Produktempfehlung für dein Pferd zu.</p>
          <ul>
            ${textProdukte.map(p => `<li>${p}</li>`).join("")}
          </ul>
          <p>
            👉 <a href="${cartUrl}" target="_blank" style="display:inline-block;padding:10px 20px;background:#4CAF50;color:white;text-decoration:none;border-radius:5px;">🛒 Jetzt bestellen</a>
          </p>
          <p>Liebe Grüße<br>Dein Kristallkraft-Team</p>
        `;
      }
    });

    document.getElementById("copyButton").addEventListener("click", function () {
      const textarea = document.getElementById("angebotText");
      if (textarea.style.display === "none") {
        alert("Nur die Text-Version kann kopiert werden. Bitte Ausgabeformat 'Text' wählen.");
        return;
      }
      textarea.select();
      navigator.clipboard.writeText(textarea.value).then(() => {
        alert("Text wurde kopiert!");
      });
    });
  </script>
</body>
</html>